<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextShare - √âchange de texte simple</title>
    <style>
        :root {
            --primary-color: #4b6cb7;
            --secondary-color: #182848;
            --light-color: #f5f7fa;
            --success-color: #28a745;
            --warning-color: #ffc107;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: var(--secondary-color);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--primary-color);
            font-style: italic;
        }

        main {
            flex: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 800px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .text-area {
            width: 100%;
            min-height: 200px;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 1rem;
            font-size: 1rem;
            margin-bottom: 1rem;
            resize: vertical;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            background-color: var(--primary-color);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        button i {
            margin-right: 0.5rem;
        }

        .success {
            background-color: var(--success-color);
        }

        .warning {
            background-color: var(--warning-color);
            color: #333;
        }

        .code-container {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 1rem;
            margin-top: 1rem;
            position: relative;
        }

        .code-text {
            font-family: monospace;
            overflow-wrap: break-word;
            word-break: break-all;
            margin-bottom: 0.5rem;
        }

        .instructions {
            margin-top: 1.5rem;
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 1rem;
            border-left: 4px solid var(--primary-color);
        }

        .status {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 5px;
            text-align: center;
            display: none;
        }

        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        #savedTexts {
            width: 100%;
        }

        .saved-item {
            margin-bottom: 1rem;
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 1rem;
            border-left: 4px solid var(--primary-color);
            position: relative;
        }

        .saved-item-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.5rem;
        }

        .saved-item-actions button {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }

        .saved-text-preview {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }

        footer {
            text-align: center;
            padding: 1rem;
            background-color: rgba(255, 255, 255, 0.9);
            margin-top: auto;
        }
    </style>
</head>
<body>
    <header>
        <h1>TextShare</h1>
        <p class="subtitle">√âchangez et sauvegardez du texte simplement, sans compte, gratuitement</p>
    </header>

    <main>
        <div class="container">
            <textarea id="textInput" class="text-area" placeholder="Copiez ou √©crivez votre texte ici..."></textarea>
            
            <div class="button-group">
                <button id="generateBtn">
                    <i>üîë</i> G√©n√©rer un code
                </button>
                <button id="copyCodeBtn" disabled>
                    <i>üìã</i> Copier le code
                </button>
                <button id="saveBtn" class="success">
                    <i>üíæ</i> Sauvegarder localement
                </button>
                <button id="clearBtn" class="warning">
                    <i>üóëÔ∏è</i> Effacer
                </button>
            </div>

            <div id="loadCodeContainer" style="width: 100%;">
                <label for="codeInput">Entrez un code pour charger un texte:</label>
                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                    <input type="text" id="codeInput" class="text-area" style="min-height: auto; margin-bottom: 0;">
                    <button id="loadBtn">
                        <i>üì•</i> Charger
                    </button>
                </div>
            </div>

            <div id="codeContainer" class="code-container" style="display: none;">
                <div class="code-text" id="generatedCode"></div>
            </div>

            <div id="statusMessage" class="status"></div>

            <div class="instructions">
                <h3>Comment √ßa marche :</h3>
                <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                    <li>Copiez votre texte dans la zone de texte ci-dessus</li>
                    <li>Cliquez sur "G√©n√©rer un code" pour cr√©er un code unique</li>
                    <li>Copiez ce code et partagez-le</li>
                    <li>Sur un autre appareil, collez le code dans la zone "Entrez un code" et cliquez sur "Charger"</li>
                    <li>Vous pouvez aussi sauvegarder des textes localement pour y acc√©der plus tard sur le m√™me appareil</li>
                </ol>
            </div>
        </div>

        <div class="container" id="savedTextsContainer" style="display: none;">
            <h2>Textes sauvegard√©s localement</h2>
            <p>Cliquez sur un texte pour le charger dans l'√©diteur</p>
            <div id="savedTexts"></div>
        </div>
    </main>

    <footer>
        <p>TextShare ¬© 2025 - Acc√©dez √† vos textes depuis n'importe o√π, sans compte</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const textInput = document.getElementById('textInput');
            const generateBtn = document.getElementById('generateBtn');
            const copyCodeBtn = document.getElementById('copyCodeBtn');
            const saveBtn = document.getElementById('saveBtn');
            const clearBtn = document.getElementById('clearBtn');
            const loadBtn = document.getElementById('loadBtn');
            const codeInput = document.getElementById('codeInput');
            const codeContainer = document.getElementById('codeContainer');
            const generatedCode = document.getElementById('generatedCode');
            const statusMessage = document.getElementById('statusMessage');
            const savedTexts = document.getElementById('savedTexts');
            const savedTextsContainer = document.getElementById('savedTextsContainer');

            // Charger les textes sauvegard√©s lors du chargement de la page
            loadSavedTexts();

            // G√©rer la g√©n√©ration du code
            generateBtn.addEventListener('click', function() {
                const text = textInput.value.trim();
                if (!text) {
                    showStatus('Veuillez entrer du texte avant de g√©n√©rer un code', 'error');
                    return;
                }

                try {
                    // Encode le texte en Base64 en utilisant notre fonction s√©curis√©e
                    const encodedText = safeEncode(text);
                    
                    // G√©n√®re un identifiant court
                    const shortId = generateShortId();
                    
                    // Combine l'ID et le texte encod√©
                    const fullCode = `${shortId}-${encodedText}`;
                    
                    // Affiche le code
                    generatedCode.textContent = fullCode;
                    codeContainer.style.display = 'block';
                    copyCodeBtn.disabled = false;
                    
                    showStatus('Code g√©n√©r√© avec succ√®s!', 'success');
                } catch (error) {
                    console.error('Erreur lors de la g√©n√©ration du code:', error);
                    showStatus('Erreur lors de la g√©n√©ration du code. V√©rifiez que votre texte ne contient pas de caract√®res sp√©ciaux incompatibles.', 'error');
                }
            });

            // G√©rer la copie du code
            copyCodeBtn.addEventListener('click', function() {
                const codeText = generatedCode.textContent;
                navigator.clipboard.writeText(codeText).then(function() {
                    showStatus('Code copi√© dans le presse-papiers!', 'success');
                }, function() {
                    showStatus('Impossible de copier le code', 'error');
                });
            });

            // G√©rer le chargement d'un texte √† partir d'un code
            loadBtn.addEventListener('click', function() {
                const code = codeInput.value.trim();
                if (!code) {
                    showStatus('Veuillez entrer un code', 'error');
                    return;
                }

                try {
                    // S√©pare l'ID et le texte encod√©
                    const parts = code.split('-');
                    if (parts.length < 2) {
                        throw new Error('Format de code invalide');
                    }
                    
                    // R√©cup√®re le texte encod√© (tout apr√®s le premier tiret)
                    const encodedText = parts.slice(1).join('-');
                    
                    // D√©code le texte en utilisant notre fonction s√©curis√©e
                    const decodedText = safeDecode(encodedText);
                    
                    // Affiche le texte dans la zone de texte
                    textInput.value = decodedText;
                    showStatus('Texte charg√© avec succ√®s!', 'success');
                } catch (error) {
                    showStatus('Code invalide ou corrompu', 'error');
                    console.error(error);
                }
            });

            // G√©rer la sauvegarde locale
            saveBtn.addEventListener('click', function() {
                const text = textInput.value.trim();
                if (!text) {
                    showStatus('Veuillez entrer du texte avant de sauvegarder', 'error');
                    return;
                }

                // Sauvegarde le texte dans le localStorage
                saveTextLocally(text);
                showStatus('Texte sauvegard√© localement!', 'success');
                loadSavedTexts(); // Rafra√Æchit la liste des textes sauvegard√©s
            });

            // G√©rer l'effacement du texte
            clearBtn.addEventListener('click', function() {
                textInput.value = '';
                codeContainer.style.display = 'none';
                codeInput.value = '';
                showStatus('Texte effac√©', 'success');
            });

            // Fonction pour g√©n√©rer un ID court
            function generateShortId() {
                const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                let result = '';
                for (let i = 0; i < 6; i++) {
                    result += characters.charAt(Math.floor(Math.random() * characters.length));
                }
                return result;
            }
            
            // Fonction s√©curis√©e pour l'encodage en Base64 qui g√®re les caract√®res Unicode
            function safeEncode(text) {
                try {
                    return btoa(unescape(encodeURIComponent(text)));
                } catch (e) {
                    console.error("Erreur d'encodage:", e);
                    throw e;
                }
            }
            
            // Fonction s√©curis√©e pour le d√©codage Base64 qui g√®re les caract√®res Unicode
            function safeDecode(encoded) {
                try {
                    return decodeURIComponent(escape(atob(encoded)));
                } catch (e) {
                    console.error("Erreur de d√©codage:", e);
                    throw e;
                }
            }

            // Fonction pour afficher un message de statut
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'status';
                statusMessage.classList.add(type);
                statusMessage.style.display = 'block';
                
                // Cache le message apr√®s 3 secondes
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 3000);
            }

            // Fonction pour sauvegarder le texte localement
            function saveTextLocally(text) {
                // R√©cup√®re les textes d√©j√† sauvegard√©s
                let savedTextsArray = JSON.parse(localStorage.getItem('savedTexts')) || [];
                
                // Ajoute le nouveau texte avec un timestamp
                savedTextsArray.push({
                    id: Date.now(),
                    text: text,
                    date: new Date().toLocaleString()
                });
                
                // Limite √† 10 textes sauvegard√©s
                if (savedTextsArray.length > 10) {
                    savedTextsArray = savedTextsArray.slice(-10);
                }
                
                // Sauvegarde dans le localStorage
                localStorage.setItem('savedTexts', JSON.stringify(savedTextsArray));
            }

            // Fonction pour charger les textes sauvegard√©s
            function loadSavedTexts() {
                const savedTextsArray = JSON.parse(localStorage.getItem('savedTexts')) || [];
                
                if (savedTextsArray.length > 0) {
                    savedTextsContainer.style.display = 'block';
                    savedTexts.innerHTML = '';
                    
                    // Affiche les textes sauvegard√©s du plus r√©cent au plus ancien
                    savedTextsArray.slice().reverse().forEach(item => {
                        const truncatedText = item.text.length > 100 ? 
                            item.text.substring(0, 100) + '...' : 
                            item.text;
                        
                        const savedItem = document.createElement('div');
                        savedItem.className = 'saved-item';
                        
                        const preview = document.createElement('div');
                        preview.className = 'saved-text-preview';
                        preview.textContent = truncatedText;
                        
                        const date = document.createElement('small');
                        date.style.display = 'block';
                        date.style.marginTop = '0.5rem';
                        date.style.color = '#666';
                        date.textContent = `Sauvegard√© le ${item.date}`;
                        
                        const actionsDiv = document.createElement('div');
                        actionsDiv.className = 'saved-item-actions';
                        
                        const loadButton = document.createElement('button');
                        loadButton.textContent = 'Charger';
                        loadButton.className = 'success';
                        
                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = 'Supprimer';
                        deleteButton.className = 'warning';
                        
                        actionsDiv.appendChild(loadButton);
                        actionsDiv.appendChild(deleteButton);
                        
                        savedItem.appendChild(preview);
                        savedItem.appendChild(date);
                        savedItem.appendChild(actionsDiv);
                        
                        savedTexts.appendChild(savedItem);
                        
                        // Event listeners
                        preview.addEventListener('click', function() {
                            textInput.value = item.text;
                            showStatus('Texte charg√©!', 'success');
                        });
                        
                        loadButton.addEventListener('click', function() {
                            textInput.value = item.text;
                            showStatus('Texte charg√©!', 'success');
                        });
                        
                        deleteButton.addEventListener('click', function() {
                            deleteLocalText(item.id);
                        });
                    });
                } else {
                    savedTextsContainer.style.display = 'none';
                }
            }

            // Fonction pour supprimer un texte sauvegard√©
            function deleteLocalText(id) {
                let savedTextsArray = JSON.parse(localStorage.getItem('savedTexts')) || [];
                savedTextsArray = savedTextsArray.filter(item => item.id !== id);
                localStorage.setItem('savedTexts', JSON.stringify(savedTextsArray));
                loadSavedTexts();
                showStatus('Texte supprim√©!', 'success');
            }
        });
    </script>
</body>
</html>
